generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Player {
  PL_ID                Int           @id @default(autoincrement()) @map("PL_ID")
  PL_NAME              String        @unique @map("PL_NAME") @db.VarChar(45)
  PL_EMAIL             String        @unique @map("PL_EMAIL") @db.VarChar(100)
  PL_PASSWORD_HASH     String        @map("PL_PASSWORD_HASH") @db.VarChar(255)
  PL_FIREBASE_UID      String?       @unique @map("PL_FIREBASE_UID") @db.VarChar(255)
  PL_AUTH_PROVIDER     String?       @map("PL_AUTH_PROVIDER") @db.VarChar(50)
  PL_COINS             Int           @default(0) @map("PL_COINS")
  PL_GEMS              Int           @default(0) @map("PL_GEMS")
  PL_LEVEL             Int           @default(1) @map("PL_LEVEL")
  PL_AVATAR            String?       @map("PL_AVATAR") @db.VarChar(255)
  PL_LIFE              Int           @default(100) @map("PL_LIFE")
  PL_ACTIVE_DECK_COUNT Int           @default(0) @map("PL_ACTIVE_DECK_COUNT")
  PL_Created_at        DateTime      @default(now()) @map("PL_Created_at")
  
  // ðŸ”´ RELAÃ‡Ã•ES ATUALIZADAS
  decks                Deck[]
  matchesWon           Match[]       @relation("MatchWinner")
  matchesParticipated  MatchPlayer[]
  inventory            PlayerCard[]

  @@map("PLAYER")
}

model Card {
  CD_ID                Int          @id @default(autoincrement()) @map("CD_ID")
  CD_NAME              String       @unique @map("CD_NAME") @db.VarChar(100)
  CD_DESCRIPTION       String       @map("CD_DESCRIPTION") @db.VarChar(255)
  CD_TYPE              String       @map("CD_TYPE") @db.VarChar(50)
  CD_COST              Int          @map("CD_COST")
  CD_LIFE              Int?         @map("CD_LIFE")
  CD_ATTACK            Int?         @map("CD_ATTACK")
  CD_DEFENSE           Int?         @map("CD_DEFENSE")
  CD_IMAGE             String?      @map("CD_IMAGE") @db.VarChar(255)
  CD_MAX_IN_DECK       Int          @default(3) @map("CD_MAX_IN_DECK")
  CD_MAX_IN_COLLECTION Int          @default(4) @map("CD_MAX_IN_COLLECTION")
  
  // ðŸ”´ RELAÃ‡Ã•ES ATUALIZADAS
  inDecks              DeckCard[]
  inInventories        PlayerCard[]

  @@map("CARDS")
}

model PlayerCard {
  PLAYER_PL_ID   Int    @map("PLAYER_PL_ID")
  CARDS_CD_ID    Int    @map("CARDS_CD_ID")
  PL_CD_QUANTITY Int    @map("PL_CD_QUANTITY")
  card           Card   @relation(fields: [CARDS_CD_ID], references: [CD_ID])
  player         Player @relation(fields: [PLAYER_PL_ID], references: [PL_ID])

  @@id([PLAYER_PL_ID, CARDS_CD_ID])
  @@index([CARDS_CD_ID], map: "PLAYER_CARD_CARDS_CD_ID_fkey")
  @@map("PLAYER_CARD")
}

model Deck {
  DECK_ID         Int           @id @default(autoincrement()) @map("DECK_ID")
  DECK_NAME       String        @map("DECK_NAME") @db.VarChar(100)
  DECK_IS_ACTIVE  Boolean       @default(false) @map("DECK_IS_ACTIVE")
  PLAYER_PL_ID    Int           @map("PLAYER_PL_ID")
  DECK_CREATED_AT DateTime      @default(now()) @map("DECK_CREATED_AT")
  
  // ðŸ”´ RELAÃ‡Ã•ES ATUALIZADAS
  player          Player        @relation(fields: [PLAYER_PL_ID], references: [PL_ID])
  cardsInDeck     DeckCard[]    @relation("DeckToDeckCard")
  matchesUsedIn   MatchPlayer[] @relation("DeckToMatchPlayer")

  @@unique([PLAYER_PL_ID, DECK_NAME])
  @@map("DECK")
}

model DeckCard {
  DECK_ID          Int  @map("DECK_ID")
  CARDS_CD_ID      Int  @map("CARDS_CD_ID")
  DECK_CD_QUANTITY Int  @default(1) @map("DECK_CD_QUANTITY")
  DECK_CD_POSITION Int? @map("DECK_CD_POSITION")
  
  // ðŸ”´ RELAÃ‡Ã•ES ATUALIZADAS
  card             Card @relation(fields: [CARDS_CD_ID], references: [CD_ID])
  deck             Deck @relation("DeckToDeckCard", fields: [DECK_ID], references: [DECK_ID])

  @@id([DECK_ID, CARDS_CD_ID])
  @@index([DECK_ID])
  @@index([CARDS_CD_ID])
  @@map("DECK_CARD")
}

model Match {
  MATCH_ID      Int           @id @default(autoincrement()) @map("MT_ID")
  MT_START_TIME DateTime      @default(now()) @map("MT_START_TIME")
  MT_END_TIME   DateTime?     @map("MT_END_TIME")
  MT_TYPE       String        @map("MT_TYPE") @db.VarChar(50)
  MT_WINNER_ID  Int?          @map("MT_WINNER_ID")
  
  // ðŸ”´ RELAÃ‡Ã•ES ATUALIZADAS
  winner        Player?       @relation("MatchWinner", fields: [MT_WINNER_ID], references: [PL_ID])
  participants  MatchPlayer[]

  @@index([MT_WINNER_ID], map: "MATCH_MT_WINNER_ID_fkey")
  @@map("MATCH")
}

model MatchPlayer {
  MATCH_ID         Int     @map("MATCH_ID")
  PLAYER_ID        Int     @map("PLAYER_ID")
  DECK_USED_ID     Int     @map("DECK_USED_ID")
  MT_PL_FINAL_LIFE Int     @map("MT_PL_FINAL_LIFE")
  MT_PL_IS_WINNER  Boolean @map("MT_PL_IS_WINNER")
  
  // ðŸ”´ RELAÃ‡Ã•ES ATUALIZADAS
  deckUsed         Deck    @relation("DeckToMatchPlayer", fields: [DECK_USED_ID], references: [DECK_ID])
  match            Match   @relation(fields: [MATCH_ID], references: [MATCH_ID])
  player           Player  @relation(fields: [PLAYER_ID], references: [PL_ID])

  @@id([MATCH_ID, PLAYER_ID])
  @@index([DECK_USED_ID], map: "MATCH_PLAYER_DECK_USED_ID_fkey")
  @@index([PLAYER_ID], map: "MATCH_PLAYER_PLAYER_ID_fkey")
  @@map("MATCH_PLAYER")
}